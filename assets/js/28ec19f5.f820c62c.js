"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[284],{9525:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>a});var r=o(5893),t=o(1151);const i={sidebar_position:1},s=void 0,d={id:"tools/RAGBox",title:"RAGBox",description:"A very simple to use to RAG. There are three ways to use it",source:"@site/docs/tools/RAGBox.md",sourceDirName:"tools",slug:"/tools/RAGBox",permalink:"/docs/tools/RAGBox",draft:!1,unlisted:!1,editUrl:"https://github.com/foreai-co/docs/tools/RAGBox.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Tools",permalink:"/docs/category/tools"}},c={},a=[{value:"RAGbox Library",id:"ragbox-library",level:2},{value:"Install the library:",id:"install-the-library",level:3},{value:"Create your RAGbox and set the correct config:",id:"create-your-ragbox-and-set-the-correct-config",level:3},{value:"Add your docs to the RAG:",id:"add-your-docs-to-the-rag",level:3},{value:"Index the docs and update the RAG index:",id:"index-the-docs-and-update-the-rag-index",level:3},{value:"Query your RAG:",id:"query-your-rag",level:3},{value:"RAGbox REST API",id:"ragbox-rest-api",level:2},{value:"Start from docker image",id:"start-from-docker-image",level:3},{value:"Start from github clone",id:"start-from-github-clone",level:3},{value:"Add documents to the service",id:"add-documents-to-the-service",level:3},{value:"Index",id:"index",level:3},{value:"Query",id:"query",level:3}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"A very simple to use to RAG. There are three ways to use it"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"RAGbox Library"}),"\n",(0,r.jsx)(n.li,{children:"REST API locally"}),"\n",(0,r.jsx)(n.li,{children:"REST API from docker image"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"For all the examples below you'll need the openai credentials"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"export OPENAI_API_KEY=<your_dev_key_here>\nexport OPENAI_ORGANIZATION=<your_org_token_here>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ragbox-library",children:"RAGbox Library"}),"\n",(0,r.jsxs)(n.p,{children:["First, you'll need a ",(0,r.jsx)(n.code,{children:"RAGconfig"}),". You can specify it as a python dictionary. For refernce\nof configuration options, see the ",(0,r.jsx)(n.a,{href:"https://github.com/foreai-co/ragbox/blob/8957fc9eaf91c3db51e7b1060b3c647917783feb/ragbox/models/rag_model.py#L144",children:"source"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'from ragbox.models.rag_model import RagConfig\nconfig = {\n    "identifier": "myConfig",\n    "k_neighbors": 5,\n    "language_model_config": {\n        "model_type": "OpenAIChatModel"\n    },\n    "embedding_config": {\n        "model_type": "OPENAI",\n        "model_name": "text-embedding-ada-002",\n        "embedding_size": 1536\n    },\n    "index_config": {\n        "chunk_size": 1024,\n        "chunk_overlap": 64\n    },\n    "prompt_config": {\n        "prompt_format":\n        "Answer \\"{query}\\" consicely and only use information from this context: {formatted_results}"\n    }\n}\nrag_config = RagConfig(**config)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"install-the-library",children:"Install the library:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"pip install -e .\n"})}),"\n",(0,r.jsx)(n.h3,{id:"create-your-ragbox-and-set-the-correct-config",children:"Create your RAGbox and set the correct config:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'from ragbox.app.box import RAGbox\nragbox = RAGbox("/tmp", "myRAG")\nragbox.set_config(rag_config)\nragbox.set_live("MyConfig")\n'})}),"\n",(0,r.jsx)(n.h3,{id:"add-your-docs-to-the-rag",children:"Add your docs to the RAG:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'from ragbox.data_store.doc_store import Doc\nragbox.add_doc(\n    Doc(title="Mark Twain\'s wisdoms #1",\n        body="Whenever you find yourself on the side of the majority, "\n        "it is time to pause and reflect"))\nragbox.add_doc(\n    Doc(title="Mark Twain\'s wisdoms #2",\n        body="Get your facts first, then you can distort them as "\n        "you please."))\n'})}),"\n",(0,r.jsx)(n.h3,{id:"index-the-docs-and-update-the-rag-index",children:"Index the docs and update the RAG index:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ragbox.index()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"query-your-rag",children:"Query your RAG:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'result = ragbox.generate_with_refs(\n    "What should I do when I\'m in a majority?")\n#  result["response"] == "When you find yourself in a majority, pause and reflect."\n'})}),"\n",(0,r.jsx)(n.h2,{id:"ragbox-rest-api",children:"RAGbox REST API"}),"\n",(0,r.jsx)(n.h3,{id:"start-from-docker-image",children:"Start from docker image"}),"\n",(0,r.jsx)(n.p,{children:"Pull the image from the repo:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker pull forefab/ragbox\n"})}),"\n",(0,r.jsxs)(n.p,{children:["or build your own image using your own config. Make sure the config file is in\nthe ",(0,r.jsx)(n.code,{children:"ragbox"})," repository root (that way it will get copied into the container), and the\n",(0,r.jsx)(n.code,{children:"CONFIG_PATH"})," needs to be relative to the top-level ",(0,r.jsx)(n.code,{children:"ragbox"})," repository root:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker build \\\n --build-arg OPENAI_API_KEY=${OPENAI_API_KEY} \\\n --build-arg OPENAI_ORGANIZATION=${OPENAI_ORGANIZATION} \\\n -t ragbox:20231023 -t ragbox:latest \\\n -f app/docker_env/Dockerfile \\\n .\n"})}),"\n",(0,r.jsx)(n.p,{children:"The run it:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker run -p 127.0.0.1:8010:8010 -p 127.0.0.1:2222:2222 \\\n    forefab/ragbox\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can SSH into your docker container on port 2222 using user ",(0,r.jsx)(n.code,{children:"root"})," and password ",(0,r.jsx)(n.code,{children:"Docker!"}),". This can be useful for debugging the binary by accessing the filesystem and logs."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ssh root@localhost:2222\n"})}),"\n",(0,r.jsx)(n.h3,{id:"start-from-github-clone",children:"Start from github clone"}),"\n",(0,r.jsx)(n.p,{children:"Start up your RAGbox service:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"python3 ragbox_service.py \\\n    --root_path ./RAGbox-data/\n    --identifier myRAG \\\n    --port 8010\n"})}),"\n",(0,r.jsx)(n.p,{children:"On your first start, you will have to add the config to the config_store. Use:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'curl -X PUT -H "Content-Type: application/json" \\\n  -d @config.json \\\n  http://localhost:8010/api/configs/myConfig\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Make sure the config file exists and contains the json version of the above.\nYou can also use this ",(0,r.jsx)(n.a,{href:"https://github.com/foreai-co/ragbox/blob/main/ragbox/app/docker_env/openai_rag.json",children:"example config"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"You can list the configs:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"curl -X GET http://localhost:8010/api/configs\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then, set the config live:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"curl -X PUT http://localhost:8010/api/configs/myConfig/live\n"})}),"\n",(0,r.jsx)(n.p,{children:"The service will start up and you can query it via HTTP.  Next time you start it up, it will\nstart up with the config you set live."}),"\n",(0,r.jsx)(n.h3,{id:"add-documents-to-the-service",children:"Add documents to the service"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'curl -X POST -H "Content-Type: application/json" \\\n    -d \'{"docs": [\n    {\n        "title": "Mark Twains wisdoms #1",\n        "body": "Whenever you find yourself on the side of the majority, it is time to pause and reflect"\n    }, {\n        "title": "Mark Twains wisdoms #2",\n        "body": "Get your facts first, then you can distort them as you please."\n    }]}\' \\\n    http://localhost:8010/api/docs/add\n'})}),"\n",(0,r.jsx)(n.h3,{id:"index",children:"Index"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"curl http://localhost:8010/api/index\n"})}),"\n",(0,r.jsx)(n.h3,{id:"query",children:"Query"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'curl -X POST -H "Content-Type: application/json" \\\n    -d \'{"query": "What should I do when I\'\\\'\'m in a majority?"}\' \\\n    http://localhost:8010/api/query\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},1151:(e,n,o)=>{o.d(n,{Z:()=>d,a:()=>s});var r=o(7294);const t={},i=r.createContext(t);function s(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);